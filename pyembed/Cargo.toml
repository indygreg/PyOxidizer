[package]
name = "pyembed"
version = "0.11.0-pre"
authors = ["Gregory Szorc <gregory.szorc@gmail.com>"]
edition = "2018"
license = "Python-2.0 OR MPL-2.0"
description = "Embed a Python interpreter"
homepage = "https://github.com/indygreg/PyOxidizer"
repository = "https://github.com/indygreg/PyOxidizer.git"
build = "build.rs"
# Adding this line enables DEP_* environment variables to be set in
# dependent crates. We rely on this to allow crates embedding this one
# to access the artifacts we build.
links = "pythonXY"

[dependencies]
# Update documentation in lib.rs when new dependencies are added.
anyhow = "1.0.38"
cpython = "0.5.2"
libmimalloc-sys = { version = "0.1.20", features = ["extended","override","local_dynamic_tls"], optional = true }
mimalloc = { version = "0.1.24", features = ["override","local_dynamic_tls"], optional = true }
jemalloc-sys = { version = "0.3.2", optional = true }
jemallocator = { version = "0.3.2", optional = true }
snmalloc-rs = { version = "0.2", optional = true }
lazy_static = "1.4.0"
libc = "0.2.86"
memmap = "0.7.0"
python3-sys = "0.5.2"
rayon = "1.5.0"

[dependencies.python-packed-resources]
version = "0.5.0-pre"
path = "../python-packed-resources"

[dependencies.python-packaging]
version = "0.4.0-pre"
path = "../python-packaging"
default-features = false

[dependencies.tugger-file-manifest]
version = "0.1.0-pre"
path = "../tugger-file-manifest"

[target.'cfg(windows)'.dependencies]
memory-module-sys = "0.3.0"
winapi = { version = "0.3.9", features = ["libloaderapi", "memoryapi", "minwindef"] }

[dev-dependencies]
pathdiff = "0.2.0"
rusty-fork = "0.3.0"

[features]
default = ["build-mode-default"]
jemalloc = ["jemallocator","jemalloc-sys"]
gmimalloc = ["mimalloc", "libmimalloc-sys"]
snmalloc = ["snmalloc-rs"]


# The default build mode.
#
# This crate links against whatever Python is picked up by the cpython crate
# using its default link semantics.
build-mode-default = [
    "cpython-link-default",
]

# Build this crate in isolation, without using PyOxidizer.
build-mode-standalone = [
    "cpython-link-unresolved-static",
]

# Build this crate by executing a `pyoxidizer` executable to build
# required artifacts.
build-mode-pyoxidizer-exe = []

# Build this crate by reusing artifacts generated by `pyoxidizer` out-of-band.
# In this mode, the PYOXIDIZER_ARTIFACT_DIR environment variable can refer
# to the directory containing build artifacts produced by `pyoxidizer`. If not
# set, OUT_DIR will be used.
build-mode-prebuilt-artifacts = []

build-mode-extension-module = [
    "cpython/extension-module",
]

# Build mode for running tests.
build-mode-test = [
    "cpython-link-default",
]

# Build the cpython crate in unresolved static mode (we will provide a static
# library to link against).
cpython-link-unresolved-static = [
    "cpython/py-link-mode-unresolved-static",
    "cpython/python3-sys",
    "cpython/no-auto-initialize",
]

# Build the cpython with default link mode control. It will pick up the prebuilt
# libpython from PYTHON_SYS_EXECUTABLE or from PATH.
cpython-link-default = [
    "cpython/py-link-mode-default",
    "cpython/python3-sys",
    "cpython/no-auto-initialize",
]
